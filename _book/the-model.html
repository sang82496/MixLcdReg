<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 The model | Creating the mixLcdReg R package</title>
  <meta name="description" content="2 The model | Creating the mixLcdReg R package" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="2 The model | Creating the mixLcdReg R package" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 The model | Creating the mixLcdReg R package" />
  
  
  

<meta name="author" content="Sang-wook Lee" />


<meta name="date" content="2024-01-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="the-method.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preliminaries</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#description-file"><i class="fa fa-check"></i><b>1.1</b> DESCRIPTION file</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#package-level-documentation"><i class="fa fa-check"></i><b>1.2</b> Package-level documentation</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="the-model.html"><a href="the-model.html"><i class="fa fa-check"></i><b>2</b> The model</a>
<ul>
<li class="chapter" data-level="2.1" data-path="the-model.html"><a href="the-model.html#generating-data-from-model"><i class="fa fa-check"></i><b>2.1</b> Generating data from model</a></li>
<li class="chapter" data-level="2.2" data-path="the-model.html"><a href="the-model.html#visualizing-data-in-one-dimensional-case"><i class="fa fa-check"></i><b>2.2</b> Visualizing data in one-dimensional case</a></li>
<li class="chapter" data-level="2.3" data-path="the-model.html"><a href="the-model.html#visualizing-data-and-model-in-one-dimensional-case"><i class="fa fa-check"></i><b>2.3</b> Visualizing data and model in one-dimensional case</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="the-method.html"><a href="the-method.html"><i class="fa fa-check"></i><b>3</b> The method</a>
<ul>
<li class="chapter" data-level="3.1" data-path="the-method.html"><a href="the-method.html#preprocessing"><i class="fa fa-check"></i><b>3.1</b> preprocessing</a></li>
<li class="chapter" data-level="3.2" data-path="the-method.html"><a href="the-method.html#initialization"><i class="fa fa-check"></i><b>3.2</b> Initialization</a></li>
<li class="chapter" data-level="3.3" data-path="the-method.html"><a href="the-method.html#e-step"><i class="fa fa-check"></i><b>3.3</b> E-step</a></li>
<li class="chapter" data-level="3.4" data-path="the-method.html"><a href="the-method.html#m-step"><i class="fa fa-check"></i><b>3.4</b> M-step</a></li>
<li class="chapter" data-level="3.5" data-path="the-method.html"><a href="the-method.html#trying-out-the-method"><i class="fa fa-check"></i><b>3.5</b> Trying out the method</a></li>
<li class="chapter" data-level="3.6" data-path="the-method.html"><a href="the-method.html#results"><i class="fa fa-check"></i><b>3.6</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="conclude.html"><a href="conclude.html"><i class="fa fa-check"></i><b>4</b> Conclusion</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Creating the <code>mixLcdReg</code> R package</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-model" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> The model<a href="the-model.html#the-model" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Let <span class="math inline">\(X^{(t)} \in \mathbb{R}^{p}\)</span> be given fixed design points and <span class="math inline">\(Y_i^{(t)} \in \mathbb{R}^{d}\)</span> be the observed dependent variables, for <span class="math inline">\(1 \le i \le n_t, \ 1 \le t \le T\)</span>. We model <span class="math inline">\(Y_i^{(t)}\)</span> as i.i.d. draws from <span class="math inline">\(K\)</span> different <span class="math inline">\(d-\)</span>dimensional log-concave distributions, conditioning on <span class="math inline">\(X^{(t)}\)</span>. Let <span class="math inline">\(Z_i^{(t)}\)</span> denote the (latent) cluster membership so that <span class="math inline">\(P(Z_i^{(t)} =k|X^{(t)} ) = \pi_k(X^{(t)} )\)</span>, for <span class="math inline">\(1 \le k \le K\)</span>. Let <span class="math inline">\(\mu_k:\mathbb{R}^{p+1} \rightarrow \mathbb{R}^{d}\)</span> be the unknown regression function, for <span class="math inline">\(1 \le k \le K\)</span> and <span class="math inline">\(\mu_k\)</span> is assumed to belong to a given family <span class="math inline">\(M\)</span>, which is closed under scalar addition. We further assume that <span class="math inline">\(M\)</span> is the set of all affine functions so that <span class="math inline">\(\mu_k \in M\)</span> if and only if <span class="math inline">\(\mu_k (x) = \theta_{k0} + \theta_k^T x\)</span> for some coefficients <span class="math inline">\(\theta_{k0} \in \mathbb{R}^{d}\)</span> and <span class="math inline">\(\theta_k \in \mathbb{R}^{p \times d}\)</span>. The conditional error <span class="math inline">\(\varepsilon_i^{(t)} |Z_i^{(t)} =k\)</span> follows a mean zero, <span class="math inline">\(d-\)</span>dimensional log-concave density <span class="math inline">\(exp(g_k)\)</span> so that
<span class="math inline">\(Y_i^{(t)} = \theta_{k0} + \theta_k^T X^{(t)} + \varepsilon_i^{(t)}, \text{ if } Z_i^{(t)} =k\)</span>.</p>
<p>Then,
<span class="math display">\[
Y_i^{(t)} |Z_i^{(t)}  = k, X^{(t)}  \ \sim \ exp[g_k(\cdot - \theta_{k0} - \theta_k^T X^{(t)} )]
\]</span>
so that
<span class="math display">\[
Y_i^{(t)} | X^{(t)}  \ \sim \ \sum_{k=1}^K exp[g_k(\cdot - \theta_{k0} - \theta_k^T X^{(t)} )]\pi_k(X^{(t)} )
\]</span></p>
<p>We model
<span class="math display">\[
\pi_{tk}(\alpha ) = \pi_k(X^{(t)} ; \alpha)
= \frac{exp(\alpha_{k0} + \alpha_k^T X^{(t)} )}{\sum_{l=1}^K exp(\alpha_{l0} + \alpha_l^T X^{(t)} )}
\]</span>
where <span class="math inline">\(\alpha = \{ \alpha_{k0}, \alpha_{k} \}_{k=1}^K\)</span> is a collection of coefficients <span class="math inline">\(\alpha_{k0} \in \mathbb{R}\)</span> and <span class="math inline">\(\alpha_k \in \mathbb{R}^{p}\)</span> for <span class="math inline">\(1 \le k \le K\)</span>.</p>
<p>What we want to maximize here is the mixture of log-likelihood:</p>
<p><span class="math display">\[\begin{align*}
L(\alpha, \theta, g; X, Y)
&amp;= \frac{1}{N} \sum_{t=1}^T \sum_{i=1}^{n_t} \log \mathbb{P}(Y_i^{(t)}  |X^{(t)} ) \\
&amp;= \frac{1}{N} \sum_{t=1}^T \sum_{i=1}^{n_t} \log \left[ \sum_{k=1}^K exp \left( g_k \left(Y_i^{(t)} -\theta_{k0} - \theta_k^T X^{(t)}  \right) \right) \cdot \pi_{tk}(\alpha) \right]
\end{align*}\]</span></p>
<p>where the parameters are <span class="math inline">\(\alpha,\ \theta = \{ \theta_{k0},\theta_k \}_{k=1}^K,\ g = \{ g_k \}_{k=1}^K\)</span> where <span class="math inline">\(g_k\)</span> is a logdensity of a logconcave density <span class="math inline">\(exp(g_k)\)</span> for <span class="math inline">\(1 \le k \le K\)</span>, and <span class="math inline">\(X = \{X^{(t)} \}_{t=1}^T,\ Y = \{ Y_i^{(t)} \}_{i = 1,..., n_t}^{t = 1,..., T},\ N = \sum_{t=1}^T n_t\)</span></p>
<p>But directly optimizing <span class="math inline">\(L(\alpha, \theta, g; X, Y)\)</span> is difficult due to its non-convexity. Instead, using the membership <span class="math inline">\(Z_i^{(t)}\)</span>, we define the joint log-likelihood:</p>
<p><span class="math display">\[\begin{align*}
\Lambda(\alpha, \theta, g; X, Y, Z)
&amp;= \frac{1}{N} \sum_{t=1}^T \sum_{i=1}^{n_t} \sum_{k=1}^K  \mathbb{I}\{Z_i^{(t)}  =k\} \log \mathbb{P}(Y_i^{(t)} , Z_i^{(t)}  = k |X^{(t)} ) \\
&amp;= \frac{1}{N} \sum_{t, i,k}  \mathbb{I}\{Z_i^{(t)}  =k\} \left[ g_k \left(Y_i^{(t)} -\theta_{k0} -\theta_k^T X^{(t)}  \right) + \log \pi_{tk}(\alpha)  \right]
\end{align*}\]</span>
Since we can’t observe <span class="math inline">\(Z_i^{(t)}\)</span>, we define the surrogate function, which is the conditional expectation of <span class="math inline">\(\Lambda(\alpha, g, \theta; X, Y, Z)\)</span> with respect to the membership <span class="math inline">\(Z_i^{(t)}\)</span>, conditioning on <span class="math inline">\(X^{(t)}\)</span> and <span class="math inline">\(Y_i^{(t)}\)</span>:</p>
<p><span class="math display">\[
Q(\alpha, g, \theta) = Q(\alpha, g, \theta; X, Y) = \frac{1}{N} \sum_{t=1}^T \sum_{i=1}^{n_t} \sum_{k=1}^K r_{tik} \left[ g_k \left(Y_i^{(t)} -\theta_{k0} -\theta_k^T X^{(t)}  \right)) + \log \pi_{tk}(\alpha)  \right]
\]</span>
where the responsibility <span class="math inline">\(r_{tik}\)</span> is defined
<span class="math display">\[\begin{align*}
r_{tik} = r_{tik}(\alpha, \theta, g) = P(Z_i^{(t)}  = k |Y_i^{(t)} , X^{(t)} ; \alpha, \theta, g)
&amp;= \frac{exp(g_k(Y_i^{(t)} -\theta_{k0} -\theta_k^T X^{(t)} )) \pi_{tk}(\alpha)}
{\sum_{l=1}^K exp(g_l(Y_i^{(t)} -\theta_{l0} -\theta_l^T X^{(t)} )) \pi_{tl}(\alpha) }
\end{align*}\]</span></p>
<p>Note that the responsibility is a probability, so it should sum up to one with respect to k in the sense that</p>
<p><span class="math display">\[
\sum_{k=1}^K r_{tik} = \sum_{k=1}^K P(Z_i^{(t)}  = k |Y_i^{(t)} , X^{(t)} ) = 1
\]</span>
It will be useful to have data generated from this model for testing purposes, so we begin by defining a function for simulating from this model.</p>
<div id="generating-data-from-model" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Generating data from model<a href="the-model.html#generating-data-from-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The function will take as input the following arguments:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="the-model.html#cb4-1" tabindex="-1"></a><span class="do"><span id='theta0-param'>###&quot;theta0-param&quot;###</span></span></span>
<span id="cb4-2"><a href="the-model.html#cb4-2" tabindex="-1"></a><span class="co">#&#39; @param theta0 length K list, with `theta0[[k]]` being the estimate for the intercept coefficient</span></span>
<span id="cb4-3"><a href="the-model.html#cb4-3" tabindex="-1"></a><span class="co">#&#39; of the regression for kth group</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="the-model.html#cb5-1" tabindex="-1"></a><span class="do"><span id='theta-param'>###&quot;theta-param&quot;###</span></span></span>
<span id="cb5-2"><a href="the-model.html#cb5-2" tabindex="-1"></a><span class="co">#&#39; @param theta length K list, with `theta[[k]]` being the p-by-1 vector. Initial estimate for coefficients</span></span>
<span id="cb5-3"><a href="the-model.html#cb5-3" tabindex="-1"></a><span class="co">#&#39; of the regression for kth group</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="the-model.html#cb6-1" tabindex="-1"></a><span class="do"><span id='alpha-param'>###&quot;alpha-param&quot;###</span></span></span>
<span id="cb6-2"><a href="the-model.html#cb6-2" tabindex="-1"></a><span class="co">#&#39; @param alpha (p+1)-by-K matrix. The coefficients for the cluster probabilities.</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="the-model.html#cb7-1" tabindex="-1"></a><span class="do"><span id='X-param'>###&quot;X-param&quot;###</span></span></span>
<span id="cb7-2"><a href="the-model.html#cb7-2" tabindex="-1"></a><span class="co">#&#39; @param X a T-by-p matrix of covariates, where `X[[t]]` being the p-vector of independent variable at time t</span></span></code></pre></div>
<p>We define this bit of documentation in its own code chunk so that it can be easily reused since multiple functions in the package take it as input.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="the-model.html#cb8-1" tabindex="-1"></a><span class="co">#&#39; Generate data from mixture of log-concave regressions</span></span>
<span id="cb8-2"><a href="the-model.html#cb8-2" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb8-3"><a href="the-model.html#cb8-3" tabindex="-1"></a><span class="co">#&#39; The mixture of log-concave regressions model is defined as follows:</span></span>
<span id="cb8-4"><a href="the-model.html#cb8-4" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb8-5"><a href="the-model.html#cb8-5" tabindex="-1"></a><span class="co">#&#39; At time t there are n_t points generated as follows:</span></span>
<span id="cb8-6"><a href="the-model.html#cb8-6" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb8-7"><a href="the-model.html#cb8-7" tabindex="-1"></a><span class="co">#&#39; Given Z_i^{(t)} = k, Y_i^{(t)}  = theta_{k0} + theta_k^T X^{(t)} + epsilon_i^{(t)}</span></span>
<span id="cb8-8"><a href="the-model.html#cb8-8" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb8-9"><a href="the-model.html#cb8-9" tabindex="-1"></a><span class="co">#&#39; where epsilon_i^{(t)} ~ exp(g_k)</span></span>
<span id="cb8-10"><a href="the-model.html#cb8-10" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb8-11"><a href="the-model.html#cb8-11" tabindex="-1"></a><span class="co">#&#39; and P(Z_i^{(t)} =k |X^{(t)} ;alpha) = \frac{exp(alpha_{k0} + alpha_k^T X^{(t)} )}{\sum_{l=1}^K exp(alpha_{l0} + alpha_l^T X^{(t)} )}</span></span>
<span id="cb8-12"><a href="the-model.html#cb8-12" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb8-13"><a href="the-model.html#cb8-13" tabindex="-1"></a><span class="co">#&#39; This function generates Y and Z</span></span>
<span id="cb8-14"><a href="the-model.html#cb8-14" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb8-15"><a href="the-model.html#cb8-15" tabindex="-1"></a><span class="co">#&#39; For simplicity we here assume alpha = 0, K = 2, p = 2 and d = 1</span></span>
<span id="cb8-16"><a href="the-model.html#cb8-16" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb8-17"><a href="the-model.html#cb8-17" tabindex="-1"></a><a href='the-model.html#X-param'>&lt;&lt;X-param&gt;&gt;</a></span>
<span id="cb8-18"><a href="the-model.html#cb8-18" tabindex="-1"></a><a href='the-model.html#theta0-param'>&lt;&lt;theta0-param&gt;&gt;</a></span>
<span id="cb8-19"><a href="the-model.html#cb8-19" tabindex="-1"></a><a href='the-model.html#theta-param'>&lt;&lt;theta-param&gt;&gt;</a></span>
<span id="cb8-20"><a href="the-model.html#cb8-20" tabindex="-1"></a><a href='the-model.html#alpha-param'>&lt;&lt;alpha-param&gt;&gt;</a></span>
<span id="cb8-21"><a href="the-model.html#cb8-21" tabindex="-1"></a><span class="co">#&#39; @param num_points T-vector of integers giving the number of points n_t to</span></span>
<span id="cb8-22"><a href="the-model.html#cb8-22" tabindex="-1"></a><span class="co">#&#39; generate at each time point t.</span></span>
<span id="cb8-23"><a href="the-model.html#cb8-23" tabindex="-1"></a><span class="co">#&#39; @param err_type a K-vector of strings, each of which is the type of error distribution</span></span>
<span id="cb8-24"><a href="the-model.html#cb8-24" tabindex="-1"></a><span class="co">#&#39; for the each group. Now, it is one of &#39;Gaussian&#39;, &#39;exp&#39;</span></span>
<span id="cb8-25"><a href="the-model.html#cb8-25" tabindex="-1"></a><span class="co">#&#39; @return Y length T list with `Y[[t]]` being a n_t-by-d matrix</span></span>
<span id="cb8-26"><a href="the-model.html#cb8-26" tabindex="-1"></a><span class="co">#&#39; @return Z length T list with `Z[[t]]` being a n_t vector of cluster memberships</span></span>
<span id="cb8-27"><a href="the-model.html#cb8-27" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb8-28"><a href="the-model.html#cb8-28" tabindex="-1"></a><span id='generate_mix_lcd_reg'>generate_mix_lcd_reg</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(X,</span>
<span id="cb8-29"><a href="the-model.html#cb8-29" tabindex="-1"></a>                                 theta0,</span>
<span id="cb8-30"><a href="the-model.html#cb8-30" tabindex="-1"></a>                                 theta,</span>
<span id="cb8-31"><a href="the-model.html#cb8-31" tabindex="-1"></a>                                 alpha,</span>
<span id="cb8-32"><a href="the-model.html#cb8-32" tabindex="-1"></a>                                 num_points,</span>
<span id="cb8-33"><a href="the-model.html#cb8-33" tabindex="-1"></a>                                 <span class="at">err_type =</span> <span class="fu">c</span>(<span class="st">&#39;Gaussian&#39;</span>, <span class="st">&#39;exp&#39;</span>)) {</span>
<span id="cb8-34"><a href="the-model.html#cb8-34" tabindex="-1"></a>  TT <span class="ot">=</span> <span class="fu">dim</span>(X)[<span class="dv">1</span>]</span>
<span id="cb8-35"><a href="the-model.html#cb8-35" tabindex="-1"></a>  p <span class="ot">=</span> <span class="fu">dim</span>(X)[<span class="dv">2</span>]</span>
<span id="cb8-36"><a href="the-model.html#cb8-36" tabindex="-1"></a>  Y <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb8-37"><a href="the-model.html#cb8-37" tabindex="-1"></a>  Z <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb8-38"><a href="the-model.html#cb8-38" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>TT){</span>
<span id="cb8-39"><a href="the-model.html#cb8-39" tabindex="-1"></a>    tmp <span class="ot">=</span> <span class="fu">exp</span>(alpha[<span class="dv">1</span>,] <span class="sc">+</span> X[t,] <span class="sc">%*%</span> alpha[<span class="dv">2</span><span class="sc">:</span>(p<span class="sc">+</span><span class="dv">1</span>),])</span>
<span id="cb8-40"><a href="the-model.html#cb8-40" tabindex="-1"></a>    prob <span class="ot">=</span> tmp <span class="sc">/</span> <span class="fu">sum</span>(tmp)</span>
<span id="cb8-41"><a href="the-model.html#cb8-41" tabindex="-1"></a>    Z[[t]] <span class="ot">=</span> <span class="fu">rbinom</span>(num_points[t], <span class="dv">1</span>, prob[<span class="dv">2</span>])</span>
<span id="cb8-42"><a href="the-model.html#cb8-42" tabindex="-1"></a>    n1 <span class="ot">=</span> <span class="fu">sum</span>(Z[[t]] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb8-43"><a href="the-model.html#cb8-43" tabindex="-1"></a>    n2 <span class="ot">=</span> <span class="fu">sum</span>(Z[[t]] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb8-44"><a href="the-model.html#cb8-44" tabindex="-1"></a>    Xt1 <span class="ot">=</span> theta0[[<span class="dv">1</span>]] <span class="sc">+</span> X[t,] <span class="sc">%*%</span> <span class="fu">as.matrix</span>(theta[[<span class="dv">1</span>]]) </span>
<span id="cb8-45"><a href="the-model.html#cb8-45" tabindex="-1"></a>    Xt2 <span class="ot">=</span> theta0[[<span class="dv">2</span>]] <span class="sc">+</span> X[t,] <span class="sc">%*%</span> <span class="fu">as.matrix</span>(theta[[<span class="dv">2</span>]])     </span>
<span id="cb8-46"><a href="the-model.html#cb8-46" tabindex="-1"></a>    </span>
<span id="cb8-47"><a href="the-model.html#cb8-47" tabindex="-1"></a>    <span class="cf">if</span> (err_type[<span class="dv">1</span>] <span class="sc">==</span> <span class="st">&#39;Gaussian&#39;</span>) {</span>
<span id="cb8-48"><a href="the-model.html#cb8-48" tabindex="-1"></a>      e1 <span class="ot">=</span> <span class="fu">rnorm</span>(n1)</span>
<span id="cb8-49"><a href="the-model.html#cb8-49" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb8-50"><a href="the-model.html#cb8-50" tabindex="-1"></a>      e1 <span class="ot">=</span> <span class="fu">rexp</span>(n1, <span class="dv">1</span>) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb8-51"><a href="the-model.html#cb8-51" tabindex="-1"></a>    }</span>
<span id="cb8-52"><a href="the-model.html#cb8-52" tabindex="-1"></a>    <span class="cf">if</span> (err_type[<span class="dv">2</span>] <span class="sc">==</span> <span class="st">&#39;Gaussian&#39;</span>) {</span>
<span id="cb8-53"><a href="the-model.html#cb8-53" tabindex="-1"></a>      e2 <span class="ot">=</span> <span class="fu">rnorm</span>(n2)</span>
<span id="cb8-54"><a href="the-model.html#cb8-54" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb8-55"><a href="the-model.html#cb8-55" tabindex="-1"></a>      e2 <span class="ot">=</span> <span class="fu">rexp</span>(n2, <span class="dv">1</span>) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb8-56"><a href="the-model.html#cb8-56" tabindex="-1"></a>    }</span>
<span id="cb8-57"><a href="the-model.html#cb8-57" tabindex="-1"></a>    </span>
<span id="cb8-58"><a href="the-model.html#cb8-58" tabindex="-1"></a>    Y[[t]] <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, num_points[t])</span>
<span id="cb8-59"><a href="the-model.html#cb8-59" tabindex="-1"></a>    Y[[t]][Z[[t]] <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="fu">rep</span>(Xt1, n1) <span class="sc">+</span> e1</span>
<span id="cb8-60"><a href="the-model.html#cb8-60" tabindex="-1"></a>    Y[[t]][Z[[t]] <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">=</span> <span class="fu">rep</span>(Xt2, n2) <span class="sc">+</span> e2    </span>
<span id="cb8-61"><a href="the-model.html#cb8-61" tabindex="-1"></a>  }</span>
<span id="cb8-62"><a href="the-model.html#cb8-62" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Y =</span> Y,</span>
<span id="cb8-63"><a href="the-model.html#cb8-63" tabindex="-1"></a>              <span class="at">Z =</span> Z))</span>
<span id="cb8-64"><a href="the-model.html#cb8-64" tabindex="-1"></a>}</span></code></pre></div>
<p>Let’s generate an example in the <span class="math inline">\(d=1\)</span> case:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="the-model.html#cb9-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb9-2"><a href="the-model.html#cb9-2" tabindex="-1"></a>d <span class="ot">=</span> <span class="dv">1</span>; K <span class="ot">=</span> <span class="dv">2</span>; TT <span class="ot">=</span> <span class="dv">30</span></span>
<span id="cb9-3"><a href="the-model.html#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="the-model.html#cb9-4" tabindex="-1"></a>X1 <span class="ot">=</span> <span class="fu">sin</span>((<span class="dv">1</span><span class="sc">:</span>TT)<span class="sc">*</span>pi<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb9-5"><a href="the-model.html#cb9-5" tabindex="-1"></a>X2 <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, TT<span class="sc">/</span><span class="dv">2</span>), <span class="fu">rep</span>(<span class="dv">1</span>, TT<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb9-6"><a href="the-model.html#cb9-6" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">cbind</span>(X1, X2)</span>
<span id="cb9-7"><a href="the-model.html#cb9-7" tabindex="-1"></a></span>
<span id="cb9-8"><a href="the-model.html#cb9-8" tabindex="-1"></a>theta_true <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="dv">0</span>))</span>
<span id="cb9-9"><a href="the-model.html#cb9-9" tabindex="-1"></a>theta0_true <span class="ot">=</span> <span class="fu">list</span>(<span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb9-10"><a href="the-model.html#cb9-10" tabindex="-1"></a>num_points <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">200</span>, TT)</span>
<span id="cb9-11"><a href="the-model.html#cb9-11" tabindex="-1"></a>alpha_true <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">0</span>, K<span class="sc">*</span><span class="dv">3</span>), <span class="at">ncol =</span> K)</span>
<span id="cb9-12"><a href="the-model.html#cb9-12" tabindex="-1"></a>alpha_true[<span class="dv">3</span>,<span class="dv">2</span>] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb9-13"><a href="the-model.html#cb9-13" tabindex="-1"></a></span>
<span id="cb9-14"><a href="the-model.html#cb9-14" tabindex="-1"></a>dat <span class="ot">=</span> <a href='the-model.html#generate_mix_lcd_reg'>generate_mix_lcd_reg</a>(X,</span>
<span id="cb9-15"><a href="the-model.html#cb9-15" tabindex="-1"></a>                           theta0_true,</span>
<span id="cb9-16"><a href="the-model.html#cb9-16" tabindex="-1"></a>                           theta_true,</span>
<span id="cb9-17"><a href="the-model.html#cb9-17" tabindex="-1"></a>                           alpha_true,</span>
<span id="cb9-18"><a href="the-model.html#cb9-18" tabindex="-1"></a>                           num_points,</span>
<span id="cb9-19"><a href="the-model.html#cb9-19" tabindex="-1"></a>                           <span class="fu">c</span>(<span class="st">&#39;Gaussian&#39;</span>, <span class="st">&#39;exp&#39;</span>))</span>
<span id="cb9-20"><a href="the-model.html#cb9-20" tabindex="-1"></a>Y <span class="ot">=</span> dat<span class="sc">$</span>Y</span>
<span id="cb9-21"><a href="the-model.html#cb9-21" tabindex="-1"></a>Z <span class="ot">=</span> dat<span class="sc">$</span>Z</span></code></pre></div>
</div>
<div id="visualizing-data-in-one-dimensional-case" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Visualizing data in one-dimensional case<a href="the-model.html#visualizing-data-in-one-dimensional-case" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s make a function for visualizing the data in the one-dimensional case.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="the-model.html#cb10-1" tabindex="-1"></a><span class="do"><span id='Y-param'>###&quot;Y-param&quot;###</span></span></span>
<span id="cb10-2"><a href="the-model.html#cb10-2" tabindex="-1"></a><span class="co">#&#39; @param Y length T list with `Y[[t]]` being a n_t-by-d matrix</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="the-model.html#cb11-1" tabindex="-1"></a><span class="co">#&#39; Plot raw data when `d = 1`</span></span>
<span id="cb11-2"><a href="the-model.html#cb11-2" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb11-3"><a href="the-model.html#cb11-3" tabindex="-1"></a><a href='the-model.html#Y-param'>&lt;&lt;Y-param&gt;&gt;</a></span>
<span id="cb11-4"><a href="the-model.html#cb11-4" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb11-5"><a href="the-model.html#cb11-5" tabindex="-1"></a><span id='plot_data'>plot_data</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(Y) {</span>
<span id="cb11-6"><a href="the-model.html#cb11-6" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">pty =</span> <span class="st">&#39;s&#39;</span>, <span class="at">cex =</span> <span class="fl">0.7</span>)</span>
<span id="cb11-7"><a href="the-model.html#cb11-7" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1</span>, TT), <span class="at">ylim =</span> <span class="fu">range</span>(<span class="fu">unlist</span>(Y)), <span class="at">col =</span> <span class="st">&#39;white&#39;</span>)</span>
<span id="cb11-8"><a href="the-model.html#cb11-8" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>TT){</span>
<span id="cb11-9"><a href="the-model.html#cb11-9" tabindex="-1"></a>    <span class="fu">points</span>(<span class="fu">rep</span>(t, <span class="fu">length</span>(Y[[t]])), Y[[t]])</span>
<span id="cb11-10"><a href="the-model.html#cb11-10" tabindex="-1"></a>  }</span>
<span id="cb11-11"><a href="the-model.html#cb11-11" tabindex="-1"></a>}</span></code></pre></div>
<p>Let’s look at our example data using this plotting function:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="the-model.html#cb12-1" tabindex="-1"></a><a href='the-model.html#plot_data'>plot_data</a>(Y)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="visualizing-data-and-model-in-one-dimensional-case" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Visualizing data and model in one-dimensional case<a href="the-model.html#visualizing-data-and-model-in-one-dimensional-case" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We’ll also want a function for plotting the data with points colored by true (or estimated) cluster. And it will be convenient to also be able to superimpose the true (or estimated) means. The next function does this:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="the-model.html#cb13-1" tabindex="-1"></a><span class="co">#&#39; Plot data colored by cluster assignment with cluster means when `d=1`</span></span>
<span id="cb13-2"><a href="the-model.html#cb13-2" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb13-3"><a href="the-model.html#cb13-3" tabindex="-1"></a><a href='the-model.html#X-param'>&lt;&lt;X-param&gt;&gt;</a></span>
<span id="cb13-4"><a href="the-model.html#cb13-4" tabindex="-1"></a><a href='the-model.html#Y-param'>&lt;&lt;Y-param&gt;&gt;</a></span>
<span id="cb13-5"><a href="the-model.html#cb13-5" tabindex="-1"></a><span class="co">#&#39; @param Z a length T list with `Z[[t]]` being a n_t vector of cluster assignments</span></span>
<span id="cb13-6"><a href="the-model.html#cb13-6" tabindex="-1"></a><a href='the-model.html#theta0-param'>&lt;&lt;theta0-param&gt;&gt;</a></span>
<span id="cb13-7"><a href="the-model.html#cb13-7" tabindex="-1"></a><a href='the-model.html#theta-param'>&lt;&lt;theta-param&gt;&gt;</a></span>
<span id="cb13-8"><a href="the-model.html#cb13-8" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb13-9"><a href="the-model.html#cb13-9" tabindex="-1"></a><span id='plot_data_and_model'>plot_data_and_model</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(X, Y, Z, theta0, theta) {</span>
<span id="cb13-10"><a href="the-model.html#cb13-10" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1</span>, TT), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">10</span>), <span class="at">col =</span> <span class="st">&#39;white&#39;</span>)</span>
<span id="cb13-11"><a href="the-model.html#cb13-11" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>TT){</span>
<span id="cb13-12"><a href="the-model.html#cb13-12" tabindex="-1"></a>    <span class="fu">points</span>(<span class="fu">rep</span>(t, <span class="fu">sum</span>(Z[[t]]<span class="sc">==</span><span class="dv">0</span>)), Y[[t]][Z[[t]]<span class="sc">==</span><span class="dv">0</span>], <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)</span>
<span id="cb13-13"><a href="the-model.html#cb13-13" tabindex="-1"></a>    <span class="fu">points</span>(<span class="fu">rep</span>(t, <span class="fu">sum</span>(Z[[t]]<span class="sc">==</span><span class="dv">1</span>)), Y[[t]][Z[[t]]<span class="sc">==</span><span class="dv">1</span>], <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>)</span>
<span id="cb13-14"><a href="the-model.html#cb13-14" tabindex="-1"></a>  }</span>
<span id="cb13-15"><a href="the-model.html#cb13-15" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="dv">1</span><span class="sc">:</span>TT, <span class="fu">rep</span>(theta0[[<span class="dv">1</span>]], TT) <span class="sc">+</span> X <span class="sc">%*%</span> theta[[<span class="dv">1</span>]], <span class="at">col =</span> <span class="st">&#39;black&#39;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb13-16"><a href="the-model.html#cb13-16" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="dv">1</span><span class="sc">:</span>TT, <span class="fu">rep</span>(theta0[[<span class="dv">2</span>]], TT) <span class="sc">+</span> X <span class="sc">%*%</span> theta[[<span class="dv">2</span>]], <span class="at">col =</span> <span class="st">&#39;black&#39;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb13-17"><a href="the-model.html#cb13-17" tabindex="-1"></a>}</span></code></pre></div>
<p>For now we can use this to visualize the true model, although later this will be useful for visualizing the estimated model.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="the-model.html#cb14-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">pty =</span> <span class="st">&#39;s&#39;</span>, <span class="at">cex =</span> <span class="fl">0.7</span>)</span>
<span id="cb14-2"><a href="the-model.html#cb14-2" tabindex="-1"></a><a href='the-model.html#plot_data_and_model'>plot_data_and_model</a>(X, Y, Z, theta0_true, theta_true)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="the-method.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
